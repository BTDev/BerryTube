<script>
const origin1 = 'http://{{.Env.DOMAIN}}{{if ne .Env.HTTP_PORT "80"}}:{{.Env.HTTP_PORT}}{{end}}';
const origin2 = 'http://www.{{.Env.DOMAIN}}{{if ne .Env.HTTP_PORT "80"}}:{{.Env.HTTP_PORT}}{{end}}';
window.onmessage = function(event){
    if (location.protocol == 'https:') {
        if (event.origin == origin1 || event.origin == origin2) {
            for (const key of Object.keys(event.data)) {
                if (localStorage[key] === undefined)
                    localStorage[key] = event.data[key];
            }
            document.cookie = 'bt-migrated=1; path=/; domain=.' + location.hostname + '; max-age=31557600';
            event.source.postMessage('done', '*');
        } else {
            event.source.postMessage("Event origin doesn't match!", '*');
        }
    } else {
        event.source.postMessage("You have configured BT to never be loaded over HTTPS! Don't do that.", '*');
    }
};
</script>
